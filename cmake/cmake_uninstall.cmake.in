# Uninstall script for KadeDB
# This file is generated by CMake, do not edit.

message(STATUS "Starting uninstallation of KadeDB")

if(NOT EXISTS "@CMAKE_CURRENT_BINARY_DIR@/install_manifest.txt")
  message(FATAL_ERROR "Cannot find install manifest: @CMAKE_CURRENT_BINARY_DIR@/install_manifest.txt")
endif()

file(READ "@CMAKE_CURRENT_BINARY_DIR@/install_manifest.txt" files)
string(REGEX REPLACE "\n" ";" files "${files}")

# Track directories that might become empty
set(processed_dirs)

foreach(file ${files})
  # Skip empty lines
  if(NOT file)
    continue()
  endif()
  
  message(STATUS "Uninstalling $ENV{DESTDIR}${file}")
  
  # Remove the file if it exists
  if(EXISTS "$ENV{DESTDIR}${file}" OR IS_SYMLINK "$ENV{DESTDIR}${file}")
    exec_program(
      "@CMAKE_COMMAND@" ARGS "-E remove \"$ENV{DESTDIR}${file}\""
      OUTPUT_VARIABLE rm_out
      RETURN_VALUE rm_retval
    )
    
    if(NOT "${rm_retval}" STREQUAL 0)
      message(WARNING "Problem when removing $ENV{DESTDIR}${file}")
    endif()
  else()
    message(STATUS "File $ENV{DESTDIR}${file} does not exist.")
  endif()
  
  # Track the directory for later cleanup
  get_filename_component(dirname "$ENV{DESTDIR}${file}" DIRECTORY)
  list(APPEND processed_dirs "${dirname}")
  
  # Also track parent directories up to the install prefix
  string(LENGTH "@CMAKE_INSTALL_PREFIX@" prefix_len)
  string(LENGTH "${dirname}" dir_len)
  
  while(dir_len GREATER prefix_len)
    get_filename_component(dirname "${dirname}" DIRECTORY)
    list(APPEND processed_dirs "${dirname}")
    string(LENGTH "${dirname}" dir_len)
  endwhile()
endforeach()

# Remove duplicate directories
list(REMOVE_DUPLICATES processed_dirs)

# Sort directories by length (deepest first) to handle nested directories properly
list(SORT processed_dirs COMPARE STRING ORDER DESCENDING)

# Remove empty directories
foreach(dir ${processed_dirs})
  if(EXISTS "${dir}" AND IS_DIRECTORY "${dir}")
    file(GLOB contents "${dir}/*")
    if(NOT contents)
      message(STATUS "Removing empty directory: ${dir}")
      file(REMOVE_RECURSE "${dir}")
    endif()
  endif()
endforeach()

# Remove the install manifest
if(EXISTS "@CMAKE_CURRENT_BINARY_DIR@/install_manifest.txt")
  file(REMOVE "@CMAKE_CURRENT_BINARY_DIR@/install_manifest.txt")
endif()

message(STATUS "Uninstallation of KadeDB complete")
